
Show by
All
Network
All list
Interface
Icon	Client Name	Client IP address	Clients MAC Address	Tx	Rx	Access time
Cisco Systems Inc
192.168.50.250
Static
F4:EA:67:04:8B:40	-	-	-
Broken
192.168.50.18
DHCP
5C:F9:DD:F9:1B:3E	-	-	-
Dell
192.168.50.190
Static
5C:F9:DD:F0:C0:D6	-	-	-
Neb
192.168.50.182
Static
24:6E:96:59:D2:88	-	-	-
Neo
192.168.50.85
Static
C8:1F:66:E8:F3:38	-	-	-
Trinity
192.168.50.183
DHCP
B8:CA:3A:63:CB:EC	-	-	-
idrac-6LL29Y1
192.168.50.54
DHCP
5C:F9:DD:F3:88:59	-	-	-
dc02
192.168.50.11
DHCP
48:0F:CF:BF:93:DA	-	-	-
2.4G
PS5
192.168.50.152
DHCP
C0:33:5E:98:14:4F	130	130	401:22:50
6G
CBU Laptop
192.168.50.67
DHCP
D4:D8:53:D1:B8:CA	1297.0	6	04:56:58
PC1
192.168.50.194
DHCP
74:DF:BF:F3:9C:FB	-	-	-
PC12
192.168.50.156
Static
00:16:6F:E7:B1:7F	-	-	-
2
Pfsense Neb
192.168.50.30
Static
AA:EE:CC:DD:EE:FF	-	-	-
2.4G
Onkyo-TX-RZ50-633C45
192.168.50.39
DHCP
6C:72:4A:14:10:FB	130	144.4	792:57:05
2.4G
K2 Printer
192.168.50.113
DHCP
FC:EE:28:08:AE:90	65	65	402:37:25
Maybe POS
192.168.50.102
DHCP
EC:B5:FA:A2:E8:00	-	-	-
Proxmox Server Solutions GmbH
192.168.50.10
Static
BC:24:11:6B:15:A4	-	-	-
Proxmox Server Solutions GmbH
192.168.50.200
Static
BC:24:11:B8:4B:89	-	-	-
Proxmox Server Solutions GmbH
192.168.50.35
Static
BC:24:11:F0:3F:68	-	-	-
ubuntu-server
192.168.50.184
DHCP
BC:24:11:84:76:F2	-	-	-
5G
Raspberry Pi (Trading) Ltd
192.168.50.201
Static
2C:CF:67:36:35:E8	351	292.5	643:16:35
5G
marypi
192.168.50.101
DHCP
D8:3A:DD:D8:25:23	390	292.5	409:28:47
2.4G
raspberrypiLED
192.168.50.68
DHCP
D8:3A:DD:60:29:B7	65	65	625:29:00
5G
Sony
192.168.50.140
DHCP
00:E4:21:7D:33:2B	1080.9	1201.0	305:47:03
deco-XE75Pro
192.168.50.202
DHCP
F0:A7:31:08:F5:9D	-	-	-
deco-XE75Pro
192.168.50.92
DHCP
F0:A7:31:08:F5:2F	-	-	-
5G
Rachio-95A7CC
192.168.50.240
DHCP
38:7C:76:95:A7:CC	150	150	02:46:52
2.4G
Thermostat
192.168.50.13
DHCP
34:6F:92:22:42:6D	65	72.2	384:12:58
5G
android-dhcp-12
192.168.50.177
DHCP
A8:93:4A:66:3E:F1	866.7	780	53:09:33
5G
android-dhcp-14
192.168.50.103
DHCP
02:2B:19:55:24:A7	1134.2	907.4	47:15:21
5G
NULL
192.168.50.93
DHCP
32:20:94:24:6B:30	1080.9	154.8	28:25:36
5G
Aquarium
192.168.50.87
DHCP
E4:5F:01:FC:69:B9	390	195	78:58:37

$cred = Get-Credential
Rename-Computer -NewName "WIN101-01" -DomainCredential $cred -Restart



# Set DNS to dc02
Set-DnsClientServerAddress -InterfaceAlias "Ethernet*" -ServerAddresses 192.168.50.11

# Test
nslookup scholarsecure.local

# Then rename
Rename-Computer -NewName "WIN101-01" -Restart


Get-WinEvent -LogName Security -MaxEvents 10 | Where-Object {$_.Id -eq 4625} | Format-List TimeCreated, Message


Get-WinEvent -LogName Security -MaxEvents 50 | Where-Object {$_.Properties[5].Value -eq 'teststudent01'} | Select-Object TimeCreated, Id

# Allow multiple RDP sessions
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fSingleSessionPerUser" -Value 0

# Also enable remote desktop services to allow concurrent sessions
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" -Name "fSingleSessionPerUser" -Value 0 -ErrorAction SilentlyContinue



Get-WinEvent -LogName "Microsoft-Windows-TerminalServices-LocalSessionManager/Operational" -MaxEvents 10 | Format-Table TimeCreated, Id, Message -Wrap

Get-WinEvent -LogName Security -MaxEvents 30 | Where-Object {$_.Id -in 4624,4625,4634} | Select-Object -First 10 TimeCreated, Id, @{N='Account';E={$_.Properties[5].Value}}, @{N='LogonType';E={$_.Properties[8].Value}}, @{N='Source';E={$_.Properties[18].Value}}


Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name "DisableRestrictedAdmin"


Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name "DisableRestrictedAdmin" -Value 0

Get-WinEvent -LogName "Microsoft-Windows-TerminalServices-LocalSessionManager/Operational" -MaxEvents 5 | Format-Table TimeCreated, Id, Message -Wrap



# Check for any errors around the login time
Get-WinEvent -LogName "Microsoft-Windows-TerminalServices-LocalSessionManager/Operational" -MaxEvents 20 | Format-Table TimeCreated, Id, Message -Wrap

# Check for any failed logon scripts
Get-WinEvent -LogName Application -MaxEvents 20 | Where-Object {$_.LevelDisplayName -eq "Error"} | Format-Table TimeCreated, Message -Wrap

hostname
net localgroup Administrators
Get-WinEvent -LogName Security -MaxEvents 50 | Where-Object {$_.Id -in 4624,4625,4634} | Select-Object -First 10 TimeCreated, Id, @{N='Account';E={$_.Properties[5].Value}}, @{N='LogonType';E={$_.Properties[8].Value}}



Add-LocalGroupMember -Group "Administrators" -Member "SCHOLARSECURE\Domain Users"
net localgroup Administrators

cat > /tmp/windows_sso_setup.ps1 << 'POWERSHELL'
#Requires -RunAsAdministrator
<#
.SYNOPSIS
    Configure Windows VM for Scholar-Secure Kerberos SSO
.DESCRIPTION
    - Enables RestrictedAdmin mode for RDP
    - Joins domain (optional)
    - Adds domain group to local Administrators
    - Enables RDP and configures firewall
    - Sets hostname (optional)
.EXAMPLE
    .\Setup-ScholarSecureVM.ps1 -Hostname "LAB-VM-101" -JoinDomain
.EXAMPLE
    .\Setup-ScholarSecureVM.ps1 -SkipDomainJoin
#>

param(
    [string]$Hostname,
    [switch]$JoinDomain,
    [switch]$SkipDomainJoin,
    [string]$DomainName = "SCHOLARSECURE.LOCAL",
    [string]$DomainOU = "OU=Lab VMs,DC=scholarsecure,DC=local",
    [string]$AdminGroup = "SCHOLARSECURE\Domain Users",
    [string]$DCAddress = "192.168.50.11"
)

$ErrorActionPreference = "Stop"

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Scholar-Secure VM SSO Setup" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan

# 1. Set hostname if provided
if ($Hostname) {
    Write-Host "`n[1/6] Setting hostname to: $Hostname" -ForegroundColor Yellow
    if ($env:COMPUTERNAME -ne $Hostname) {
        Rename-Computer -NewName $Hostname -Force
        Write-Host "  Hostname will change after reboot" -ForegroundColor Green
    } else {
        Write-Host "  Hostname already set" -ForegroundColor Green
    }
} else {
    Write-Host "`n[1/6] Skipping hostname (not specified)" -ForegroundColor Gray
}

# 2. Configure DNS to point to DC
Write-Host "`n[2/6] Configuring DNS to point to DC ($DCAddress)" -ForegroundColor Yellow
$adapters = Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
foreach ($adapter in $adapters) {
    Set-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -ServerAddresses $DCAddress
    Write-Host "  Set DNS on $($adapter.Name)" -ForegroundColor Green
}

# 3. Enable RestrictedAdmin Mode (CRITICAL for Kerberos SSO)
Write-Host "`n[3/6] Enabling RestrictedAdmin Mode" -ForegroundColor Yellow
$regPath = "HKLM:\System\CurrentControlSet\Control\Lsa"
$regName = "DisableRestrictedAdmin"

# Create key if it doesn't exist
if (!(Test-Path $regPath)) {
    New-Item -Path $regPath -Force | Out-Null
}

# Set value to 0 (enabled)
Set-ItemProperty -Path $regPath -Name $regName -Value 0 -Type DWord
$value = Get-ItemProperty -Path $regPath -Name $regName -ErrorAction SilentlyContinue
if ($value.DisableRestrictedAdmin -eq 0) {
    Write-Host "  RestrictedAdmin enabled successfully" -ForegroundColor Green
} else {
    Write-Host "  WARNING: Could not verify RestrictedAdmin setting" -ForegroundColor Red
}

# 4. Enable Remote Desktop
Write-Host "`n[4/6] Enabling Remote Desktop" -ForegroundColor Yellow

# Enable RDP
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
Write-Host "  RDP enabled" -ForegroundColor Green

# Disable NLA requirement (optional - makes testing easier)
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 0
Write-Host "  NLA requirement disabled" -ForegroundColor Green

# Enable firewall rules
Enable-NetFirewallRule -DisplayGroup "Remote Desktop" -ErrorAction SilentlyContinue
Write-Host "  Firewall rules enabled" -ForegroundColor Green

# 5. Join Domain (if requested)
if ($JoinDomain -and !$SkipDomainJoin) {
    Write-Host "`n[5/6] Joining domain: $DomainName" -ForegroundColor Yellow
    
    # Test DC connectivity
    if (Test-Connection -ComputerName $DCAddress -Count 1 -Quiet) {
        Write-Host "  DC is reachable" -ForegroundColor Green
        
        # Prompt for credentials
        Write-Host "  Enter domain admin credentials:" -ForegroundColor Yellow
        $cred = Get-Credential -Message "Domain Admin for $DomainName"
        
        try {
            if ($DomainOU) {
                Add-Computer -DomainName $DomainName -Credential $cred -OUPath $DomainOU -Force
            } else {
                Add-Computer -DomainName $DomainName -Credential $cred -Force
            }
            Write-Host "  Domain join successful (reboot required)" -ForegroundColor Green
        } catch {
            Write-Host "  Domain join failed: $_" -ForegroundColor Red
        }
    } else {
        Write-Host "  ERROR: Cannot reach DC at $DCAddress" -ForegroundColor Red
    }
} else {
    Write-Host "`n[5/6] Skipping domain join" -ForegroundColor Gray
}

# 6. Add domain group to local Administrators
Write-Host "`n[6/6] Adding $AdminGroup to local Administrators" -ForegroundColor Yellow
try {
    Add-LocalGroupMember -Group "Administrators" -Member $AdminGroup -ErrorAction SilentlyContinue
    Write-Host "  Added $AdminGroup to Administrators" -ForegroundColor Green
} catch {
    if ($_.Exception.Message -match "already a member") {
        Write-Host "  $AdminGroup is already a member" -ForegroundColor Green
    } else {
        Write-Host "  Note: Will work after domain join and reboot" -ForegroundColor Yellow
    }
}

# Summary
Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "Setup Complete!" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host @"

Configuration Applied:
  [x] RestrictedAdmin Mode: Enabled
  [x] Remote Desktop: Enabled
  [x] DNS: $DCAddress
  [x] Admin Group: $AdminGroup

Next Steps:
  1. Reboot this VM
  2. On DC, add SPN for this VM:
     sudo samba-tool delegation add-service svc_guacd 'TERMSRV/$env:COMPUTERNAME'
     sudo samba-tool delegation add-service svc_guacd 'TERMSRV/$env:COMPUTERNAME.$($DomainName.ToLower())'
  3. Test Kerberos SSO from Scholar-Secure

"@ -ForegroundColor White

$reboot = Read-Host "Reboot now? (y/n)"
if ($reboot -eq "y") {
    Restart-Computer -Force
}
POWERSHELL

cat /tmp/windows_sso_setup.ps1












